{{ define "main" }}
<br>
<br>
<br>

  {{ .Content }}


  <style>
    /* Publication list styling */
    ul.pub-list {
      list-style: none;
      margin: 0;
      padding: 0;
    }
    ul.pub-list > li {
      margin: 0;
      padding: .75rem 0;
      border-bottom: 1px solid #e2e2e2;
    }
    ul.pub-list > li:last-child {
      border-bottom: none;
    }
  </style>

  {{ $pages := .RegularPages }}

  {{- warnf "Pages: $s" (len $pages) -}}

  {{ if not (gt (len $pages) 0) }}
    <p>No publications found.</p>
  {{ end }}

  {{- /* Sort by date descending, then title ascending */ -}}
  {{- $pages = sort $pages "Date" "desc" -}}
  {{- $pages = sort $pages "Title" "asc" -}}

  {{- /* Render the list of publications */ -}}

  <ul class="pub-list">
    {{ range $pages }}
      <li>
        {{- $rawTitle := or .Params.title .Title -}}
        {{- $rendered := replaceRE "^<p>(.*)</p>$" "$1" $rawTitle -}}
        {{- $rendered = $rawTitle | markdownify -}}
        <span><strong>{{ $rendered }}</strong></span><br>

        {{- /* warnf "Parameters $s " .Params */ -}} 

        {{/* Safe date: use front matter date only if non-empty & matches basic pattern */}}
        {{ $d := .Date }}
        {{ with .Params.date }}
          {{ $datestr := trim . " " }}
          {{ if and (ne $datestr "") (findRE `^\d{4}-\d{2}-\d{2}` $datestr) }}
            {{ $d = time $datestr }}
          {{ end }}
        {{ end }}
        <time datetime="{{ $d.Format "2006-01-02" }}">{{ $d.Format "2006-01-02" }}</time><br>

        {{ with .Params.abstract }}
          {{- $plain := . | markdownify | plainify | replaceRE `\s+` " " -}}
          {{- $words := split $plain " " -}}
          {{- $previewWords := cond (gt (len $words) 24) (first 24 $words) $words -}}
          {{- $preview := delimit $previewWords " " -}}
          <br>
          <div>{{ $preview }}{{ if gt (len $words) 24 }}â€¦{{ end }}</div>
          <br>
      {{ end }}

        {{- $authors := .Params.authors -}}
        {{- /* warnf "authors: $s" $authors */ -}}
      {{- if $authors -}}
        {{- if reflect.IsSlice $authors -}}
          {{ delimit $authors ", " " and " }}<br>
        {{- else -}}
          {{ $authors }}<br>
        {{- end -}}
      {{- end -}}
        <a href="{{ .RelPermalink }}">Read more</a>
        <br><br>
      </li>
    {{ end }}
  </ul>
{{ end }}